{% load static tailwind_tags i18n %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Oxygen:wght@300;400;700&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0"
    />

    <title>ANGKOR LUXE - Gestion locative optimisée</title>
    <meta
      name="description"
      content="ANGKOR LUXE offre des solutions de gestion locative complètes en Cambodge, garantissant rentabilité, tranquillité d'esprit et sécurité pour vos locations. Découvrez nos services adaptés à vos besoins."
    />
    <script
      src="https://kit.fontawesome.com/33a775bcdb.js"
      crossorigin="anonymous"
    ></script>

    <link
      href="https://cdn.jsdelivr.net/npm/aos@2.3.1/dist/aos.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/aos@2.3.1/dist/aos.js"></script>

    {% tailwind_css %}
  </head>
  <body class="bg-black">
    {% include '_header.html' %}

    <main>
      {% block content %}
      <!-- Le contenu spécifique des pages sera inséré ici -->
      {% endblock %}
    </main>

    {% include '_footer.html' %}

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Sélection et application de la langue choisie
        var languageSelector = document.getElementById("languageSelector");
        if (languageSelector) {
          var selectedLanguage = "{{ request.LANGUAGE_CODE }}";
          languageSelector.value = selectedLanguage;
        }

        // Fonction pour sauvegarder la position de défilement et soumettre le formulaire
        window.saveScrollPositionAndSubmitForm = function (selectElement) {
          localStorage.setItem(
            "scrollPosition",
            window.pageYOffset || document.documentElement.scrollTop
          );
          selectElement.form.submit();
        };

        // Restaurer la position de défilement précédemment sauvegardée après rechargement
        var scrollPosition = localStorage.getItem("scrollPosition");
        if (scrollPosition) {
          window.scrollTo(0, scrollPosition);
          localStorage.removeItem("scrollPosition");
        }
      });
    </script>

    <script>
      AOS.init();
    </script>

<!-- Chargement de jQuery s'il n'est pas déjà chargé -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script>
  $(document).ready(function () {
    // Définition des expressions régulières pour la validation des champs
    var nameRegex = /^[a-zA-Z\s]+$/; // Lettres et espaces uniquement pour les noms
    var phoneRegex = /^[0-9\s\-\(\)]+$/; // Chiffres, espaces, tirets et parenthèses pour les numéros de téléphone
    var maxChars = 1000; // Nombre maximum de caractères autorisés pour le message

    // Fonction pour valider les champs du formulaire
    function validateField(fieldId, regex, errorMsgId, errorMsg) {
      $(fieldId).blur(function () {
        var fieldValue = $(this).val();
        if (fieldValue && !regex.test(fieldValue)) {
          $(errorMsgId).text(errorMsg).show(); // Affiche le message d'erreur si la valeur du champ n'est pas valide
        } else {
          $(errorMsgId).hide(); // Cache le message d'erreur si la valeur du champ est valide
        }
      });
    }

    // Application de la validation pour chaque champ
    validateField(
      "#id_email",
      /^[^\s@]+@[^\s@]+\.[^\s@]+$/,
      "#error_email",
      '{% trans "Please enter a valid email address." %}'
    );

    validateField(
      "#id_first_name",
      nameRegex,
      "#error_first_name",
      '{% trans "Please enter a valid name with letters only." %}'
    );

    validateField(
      "#id_last_name",
      nameRegex,
      "#error_last_name",
      '{% trans "Please enter a valid name with letters only." %}'
    );

    validateField(
      "#id_phone",
      phoneRegex,
      "#error_phone",
      '{% trans "Please enter a valid phone number with digits only." %}'
    );

    // Gestion du compteur de caractères pour le champ de message
    $("#id_message").on("input", function () {
      var currentLength = $(this).val().length;
      $("#char_count").text(currentLength + "/" + maxChars); // Mise à jour du compteur

      // Changement de couleur du compteur selon la longueur du message
      if (currentLength >= maxChars) {
        $("#char_count").css("color", "red"); // Rouge si le maximum est atteint ou dépassé
      } else if (currentLength > 900) {
        $("#char_count").css("color", "orange"); // Orange si proche du maximum
      } else {
        $("#char_count").css("color", "white"); // Blanc par défaut
      }

      // Empêche l'ajout de caractères au-delà du maximum autorisé
      if (currentLength > maxChars) {
        $(this).val($(this).val().substr(0, maxChars));
      }
    });
  });
</script>

  </body>
</html>
